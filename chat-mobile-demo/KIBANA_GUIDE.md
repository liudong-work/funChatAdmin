# ğŸ¨ Kibanaå¯è§†åŒ–ä½¿ç”¨æŒ‡å—

## ğŸ“‹ **è®¿é—®ä¿¡æ¯**

### **Kibanaæ§åˆ¶å°**
- **è®¿é—®åœ°å€**: http://localhost:5601
- **çŠ¶æ€**: âœ… å·²å¯åŠ¨
- **è¿æ¥åˆ°**: Elasticsearch (http://localhost:9200)

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### 1. **æ‰“å¼€æµè§ˆå™¨è®¿é—®**
```
http://localhost:5601
```

### 2. **é¦–æ¬¡ä½¿ç”¨è®¾ç½®**

#### **è·³è¿‡æ¬¢è¿ç•Œé¢**
é¦–æ¬¡è®¿é—®æ—¶ä¼šçœ‹åˆ°æ¬¢è¿ç•Œé¢ï¼Œå¯ä»¥ï¼š
- ç‚¹å‡» "Explore on my own" è·³è¿‡å¼•å¯¼
- æˆ–è€…è·Ÿéšå‘å¯¼è¿›è¡Œé…ç½®

#### **åˆ›å»ºç´¢å¼•æ¨¡å¼ (Index Pattern)**

1. ç‚¹å‡»å·¦ä¾§èœå• â˜° â†’ **Management** â†’ **Stack Management**
2. åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹© **Index Patterns**
3. ç‚¹å‡» **Create index pattern**
4. è¾“å…¥ç´¢å¼•æ¨¡å¼åç§°ï¼š`chat_messages*`
5. é€‰æ‹©æ—¶é—´å­—æ®µï¼š`created_at`
6. ç‚¹å‡» **Create index pattern**

## ğŸ“Š **åŠŸèƒ½ä½¿ç”¨**

### **1. Discover - æ•°æ®æ¢ç´¢**

#### **æŸ¥çœ‹æ¶ˆæ¯æ•°æ®**
1. ç‚¹å‡»å·¦ä¾§èœå• â˜° â†’ **Discover**
2. é€‰æ‹©ç´¢å¼•æ¨¡å¼ï¼š`chat_messages*`
3. è®¾ç½®æ—¶é—´èŒƒå›´ï¼ˆå³ä¸Šè§’ï¼‰
4. æŸ¥çœ‹æ¶ˆæ¯åˆ—è¡¨å’Œè¯¦æƒ…

#### **æœç´¢æ¶ˆæ¯**
åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ï¼š
```
content: "æµ‹è¯•"
```

#### **é«˜çº§æœç´¢**
```
# æœç´¢ç‰¹å®šå‘é€è€…çš„æ¶ˆæ¯
sender_uuid: "user_1760235816214_wzlf0j2vp"

# æœç´¢ç‰¹å®šæ—¶é—´èŒƒå›´
created_at: [2025-01-01 TO 2025-12-31]

# ç»„åˆæœç´¢
content: "ä½ å¥½" AND sender_id: "8"
```

### **2. Dashboard - æ•°æ®å¯è§†åŒ–**

#### **åˆ›å»ºä»ªè¡¨æ¿**
1. ç‚¹å‡»å·¦ä¾§èœå• â˜° â†’ **Dashboard**
2. ç‚¹å‡» **Create dashboard**
3. ç‚¹å‡» **Add** æ·»åŠ å¯è§†åŒ–å›¾è¡¨

#### **æ¨èçš„å¯è§†åŒ–å›¾è¡¨**

##### **æ¶ˆæ¯é‡ç»Ÿè®¡**
- **ç±»å‹**: Line Chart / Bar Chart
- **æŒ‡æ ‡**: Count
- **æ—¶é—´å­—æ®µ**: created_at
- **ç”¨é€”**: æŸ¥çœ‹æ¶ˆæ¯å‘é€è¶‹åŠ¿

##### **ç”¨æˆ·æ´»è·ƒåº¦**
- **ç±»å‹**: Pie Chart
- **èšåˆ**: Terms
- **å­—æ®µ**: sender_uuid
- **ç”¨é€”**: æŸ¥çœ‹å“ªäº›ç”¨æˆ·æœ€æ´»è·ƒ

##### **å¯¹è¯åˆ†å¸ƒ**
- **ç±»å‹**: Heat Map
- **Xè½´**: sender_uuid
- **Yè½´**: receiver_uuid
- **ç”¨é€”**: æŸ¥çœ‹ç”¨æˆ·ä¹‹é—´çš„å¯¹è¯å…³ç³»

##### **æ¶ˆæ¯ç±»å‹åˆ†å¸ƒ**
- **ç±»å‹**: Pie Chart
- **å­—æ®µ**: message_type
- **ç”¨é€”**: æŸ¥çœ‹æ–‡æœ¬ã€å›¾ç‰‡ç­‰æ¶ˆæ¯ç±»å‹æ¯”ä¾‹

### **3. Dev Tools - å¼€å‘å·¥å…·**

#### **ç›´æ¥æŸ¥è¯¢Elasticsearch**
1. ç‚¹å‡»å·¦ä¾§èœå• â˜° â†’ **Dev Tools**
2. åœ¨Consoleä¸­è¾“å…¥æŸ¥è¯¢ï¼š

```json
# æŸ¥è¯¢æ‰€æœ‰æ¶ˆæ¯
GET /chat_messages/_search
{
  "query": {
    "match_all": {}
  },
  "size": 10
}

# æœç´¢ç‰¹å®šå†…å®¹
GET /chat_messages/_search
{
  "query": {
    "match": {
      "content": "æµ‹è¯•"
    }
  }
}

# è·å–ç‰¹å®šå¯¹è¯
GET /chat_messages/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "bool": {
            "must": [
              {"term": {"sender_id": "8"}},
              {"term": {"receiver_id": "9"}}
            ]
          }
        },
        {
          "bool": {
            "must": [
              {"term": {"sender_id": "9"}},
              {"term": {"receiver_id": "8"}}
            ]
          }
        }
      ]
    }
  },
  "sort": [{"created_at": "asc"}]
}

# ç»Ÿè®¡æ¶ˆæ¯æ•°é‡
GET /chat_messages/_count

# æŸ¥çœ‹ç´¢å¼•æ˜ å°„
GET /chat_messages/_mapping

# æŸ¥çœ‹ç´¢å¼•è®¾ç½®
GET /chat_messages/_settings
```

## ğŸ“ˆ **æ¨èçš„ç›‘æ§é¢æ¿**

### **å®æ—¶æ¶ˆæ¯ç›‘æ§**
```
- æ¶ˆæ¯æ€»æ•°
- ä»Šæ—¥æ¶ˆæ¯æ•°
- æ´»è·ƒç”¨æˆ·æ•°
- å¹³å‡æ¶ˆæ¯é•¿åº¦
- æ¶ˆæ¯ç±»å‹åˆ†å¸ƒ
```

### **ç”¨æˆ·è¡Œä¸ºåˆ†æ**
```
- æœ€æ´»è·ƒç”¨æˆ·Top 10
- ç”¨æˆ·æ¶ˆæ¯å‘é€æ—¶é—´åˆ†å¸ƒ
- ç”¨æˆ·å¯¹è¯ç½‘ç»œå›¾
- æ–°å¢ç”¨æˆ·è¶‹åŠ¿
```

### **ç³»ç»Ÿæ€§èƒ½ç›‘æ§**
```
- æ¶ˆæ¯å‘é€é€Ÿç‡
- å“åº”æ—¶é—´åˆ†å¸ƒ
- é”™è¯¯ç‡ç»Ÿè®¡
- å­˜å‚¨ç©ºé—´ä½¿ç”¨
```

## ğŸ¯ **å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹**

### **æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢**
```json
GET /chat_messages/_search
{
  "query": {
    "range": {
      "created_at": {
        "gte": "2025-01-01",
        "lte": "2025-12-31"
      }
    }
  }
}
```

### **æ¨¡ç³Šæœç´¢**
```json
GET /chat_messages/_search
{
  "query": {
    "fuzzy": {
      "content": {
        "value": "ä½ å¥½",
        "fuzziness": "AUTO"
      }
    }
  }
}
```

### **èšåˆç»Ÿè®¡**
```json
GET /chat_messages/_search
{
  "size": 0,
  "aggs": {
    "messages_per_user": {
      "terms": {
        "field": "sender_uuid",
        "size": 10
      }
    },
    "messages_over_time": {
      "date_histogram": {
        "field": "created_at",
        "calendar_interval": "day"
      }
    }
  }
}
```

## ğŸ”§ **æœåŠ¡ç®¡ç†**

### **å¯åŠ¨Kibana**
```bash
cd /Users/liudong/Desktop/myGitProgect/appdemo/chat-mobile-demo/backend/kibana-8.11.0
nohup ./bin/kibana > kibana.log 2>&1 &
```

### **åœæ­¢Kibana**
```bash
pkill -f kibana
```

### **æŸ¥çœ‹æ—¥å¿—**
```bash
tail -f /Users/liudong/Desktop/myGitProgect/appdemo/chat-mobile-demo/backend/kibana-8.11.0/kibana.log
```

### **æ£€æŸ¥çŠ¶æ€**
```bash
curl http://localhost:5601/api/status
```

## ğŸ’¡ **æŠ€å·§å’Œæœ€ä½³å®è·µ**

### **æ€§èƒ½ä¼˜åŒ–**
1. **ä½¿ç”¨æ—¶é—´èŒƒå›´è¿‡æ»¤** - é™åˆ¶æŸ¥è¯¢çš„æ—¶é—´èŒƒå›´å¯ä»¥æé«˜æ€§èƒ½
2. **åˆç†ä½¿ç”¨èšåˆ** - èšåˆæŸ¥è¯¢æ¯”æ™®é€šæŸ¥è¯¢æ›´æ¶ˆè€—èµ„æº
3. **ä¿å­˜å¸¸ç”¨æŸ¥è¯¢** - å¯ä»¥ä¿å­˜ä¸ºSaved Searchä¾¿äºé‡ç”¨

### **æ•°æ®åˆ†æ**
1. **ä½¿ç”¨è¿‡æ»¤å™¨** - ç»„åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶è¿›è¡Œç²¾å‡†åˆ†æ
2. **å¯¼å‡ºæ•°æ®** - å¯ä»¥å¯¼å‡ºCSVæ ¼å¼çš„æ•°æ®è¿›è¡Œæ·±å…¥åˆ†æ
3. **åˆ›å»ºå‘Šè­¦** - è®¾ç½®é˜ˆå€¼å‘Šè­¦ç›‘æ§å¼‚å¸¸æƒ…å†µ

### **å¯è§†åŒ–æŠ€å·§**
1. **ä½¿ç”¨åˆé€‚çš„å›¾è¡¨ç±»å‹** - ä¸åŒæ•°æ®é€‚åˆä¸åŒçš„å¯è§†åŒ–æ–¹å¼
2. **æ·»åŠ äº¤äº’åŠŸèƒ½** - ä½¿ç”¨drill-downåŠŸèƒ½æ·±å…¥æŸ¥çœ‹æ•°æ®
3. **å®šæœŸåˆ·æ–°** - è®¾ç½®è‡ªåŠ¨åˆ·æ–°é—´éš”å®æ—¶ç›‘æ§æ•°æ®

## ğŸ”— **ç›¸å…³é“¾æ¥**

- **Elasticsearch**: http://localhost:9200
- **Kibana**: http://localhost:5601
- **åç«¯æœåŠ¡**: http://localhost:8889
- **å‰ç«¯åº”ç”¨**: http://localhost:8081

## ğŸ“š **å‚è€ƒæ–‡æ¡£**

- [Kibanaå®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/kibana/current/index.html)
- [ElasticsearchæŸ¥è¯¢DSL](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html)
- [Kibanaå¯è§†åŒ–æŒ‡å—](https://www.elastic.co/guide/en/kibana/current/dashboard.html)

## ğŸ‰ **å¼€å§‹ä½¿ç”¨**

ç°åœ¨å°±æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5601 å¼€å§‹æ¢ç´¢ä½ çš„èŠå¤©æ•°æ®å§ï¼
