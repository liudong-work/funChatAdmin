# 🚀 真机测试快速指南

## 📋 测试前准备清单

### ✅ 已完成
- [x] EAS CLI 已安装
- [x] Expo 账号已登录（mangguo）
- [x] 真实 WebRTC 功能已实现
- [x] 音频质量优化已完成
- [x] 权限配置已就绪

### ⏳ 待完成
- [ ] 构建真机测试包
- [ ] 安装到测试设备
- [ ] 进行功能测试

---

## 🔨 构建真机测试包

### 选项 1：iOS 设备测试

```bash
# 构建 iOS 开发版本（推荐）
eas build --platform ios --profile development

# 构建过程：
# 1. 上传代码到 EAS 服务器
# 2. 云端编译（约 10-15 分钟）
# 3. 下载 .ipa 文件
# 4. 使用 Apple Configurator 或 Xcode 安装到设备
```

**安装方法**：
1. 下载生成的 .ipa 文件
2. 连接 iPhone 到电脑
3. 打开 Xcode → Window → Devices and Simulators
4. 拖拽 .ipa 到设备列表中

### 选项 2：Android 设备测试（推荐，更简单）

```bash
# 构建 Android 开发版本
eas build --platform android --profile development

# 构建过程：
# 1. 上传代码到 EAS 服务器
# 2. 云端编译（约 10-15 分钟）
# 3. 下载 .apk 文件
# 4. 直接安装到 Android 设备
```

**安装方法**：
1. 下载生成的 .apk 文件
2. 发送到 Android 手机（微信、QQ、邮件等）
3. 在手机上点击安装
4. 允许"未知来源"安装（如果系统提示）

---

## 🧪 测试步骤

### 准备工作

1. **准备两台设备**
   - 设备 A：测试账号 A
   - 设备 B：测试账号 B
   - 可以是 iOS + iOS，Android + Android，或 iOS + Android

2. **启动后端服务**
   ```bash
   cd backend
   node src/server-simple.js
   
   # 确认服务运行在端口 8889
   ```

3. **确保网络连接**
   - 两台设备连接到同一 Wi-Fi
   - 或者修改 `config/api.js` 使用公网 IP

### 测试场景 1：发起语音通话

**设备 A 操作**：
1. 打开应用，登录账号 A
2. 进入"消息"页面
3. 点击与账号 B 的聊天
4. 点击右上角 📞 通话按钮
5. 等待对方接听

**设备 B 操作**：
1. 应该收到来电通知
2. 看到来电界面（显示来电方信息）
3. 点击绿色"接听"按钮
4. 通话开始

**✅ 检查点**：
- [ ] 设备 A 显示"正在呼叫..."
- [ ] 设备 B 收到来电提示
- [ ] 接听后，双方显示"通话中"
- [ ] 通话时长开始计时（00:00, 00:01, 00:02...）
- [ ] **设备 A 能听到设备 B 的声音**
- [ ] **设备 B 能听到设备 A 的声音**
- [ ] 音质清晰，无明显延迟

### 测试场景 2：静音功能

**操作**：
1. 在通话中，点击 🎤 静音按钮
2. 对方说话，确认能听到
3. 自己说话，确认对方听不到
4. 再次点击恢复

**✅ 检查点**：
- [ ] 静音后按钮变为 🔇
- [ ] 对方听不到你的声音
- [ ] 你仍能听到对方的声音
- [ ] 恢复后对方能再次听到你

### 测试场景 3：拒绝通话

**操作**：
1. 设备 A 发起通话
2. 设备 B 点击红色"拒绝"按钮

**✅ 检查点**：
- [ ] 设备 A 显示"通话被拒绝"
- [ ] 双方返回聊天界面
- [ ] 没有资源泄漏（可以再次发起通话）

### 测试场景 4：挂断通话

**操作**：
1. 建立通话后，任意一方点击挂断

**✅ 检查点**：
- [ ] 双方通话结束
- [ ] 双方返回聊天界面
- [ ] 显示通话时长
- [ ] 可以再次发起通话

### 测试场景 5：长时间通话

**操作**：
1. 建立通话后，持续 5 分钟以上

**✅ 检查点**：
- [ ] 通话保持稳定
- [ ] 音质没有下降
- [ ] 时长正常计时
- [ ] 没有断线

---

## 📝 测试记录表

### 设备信息

| 项目 | 设备 A | 设备 B |
|------|--------|--------|
| 设备型号 | ________ | ________ |
| 系统版本 | ________ | ________ |
| 网络类型 | ________ | ________ |
| 账号 | ________ | ________ |

### 功能测试结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 发起通话 | ☐ 通过 ☐ 失败 | |
| 接听通话 | ☐ 通过 ☐ 失败 | |
| 音频双向传输 | ☐ 通过 ☐ 失败 | |
| 音质评价 | ☐ 优秀 ☐ 良好 ☐ 一般 ☐ 差 | |
| 延迟评价 | ☐ <200ms ☐ <500ms ☐ >500ms | |
| 静音功能 | ☐ 通过 ☐ 失败 | |
| 拒绝通话 | ☐ 通过 ☐ 失败 | |
| 挂断通话 | ☐ 通过 ☐ 失败 | |
| 长时间通话 | ☐ 通过 ☐ 失败 | |

---

## 🐛 常见问题

### 问题 1：安装失败

**iOS**：
- 确认设备已添加到开发者账号
- 检查证书是否有效
- 尝试重启设备

**Android**：
- 允许"未知来源"应用安装
- 确认有足够存储空间
- 尝试卸载旧版本

### 问题 2：麦克风权限被拒绝

**操作**：
1. iOS: 设置 → 隐私 → 麦克风 → 找到应用 → 开启
2. Android: 设置 → 应用 → 权限 → 麦克风 → 允许

### 问题 3：听不到对方声音

**检查**：
1. ☐ 静音按钮是否被按下
2. ☐ 设备音量是否为 0
3. ☐ 查看控制台日志：是否显示"收到远程音频流"
4. ☐ 尝试重新发起通话

### 问题 4：无法连接

**检查**：
1. ☐ 后端服务是否运行（访问 http://192.168.1.6:8889/health）
2. ☐ 两台设备是否在同一网络
3. ☐ 防火墙是否阻止连接
4. ☐ 查看应用日志（下方有说明）

---

## 📊 查看应用日志

### iOS 设备
1. 连接设备到 Mac
2. 打开 Safari → 开发 → [设备名] → 选择应用
3. 在控制台中查看日志

### Android 设备
1. 在 Chrome 浏览器访问 `chrome://inspect`
2. 找到你的设备和应用
3. 点击 "inspect" 查看日志

**关键日志标识**：
```
[WebRTC] - WebRTC 相关日志
[VoiceCall] - 通话界面日志
[WS] - WebSocket 消息日志
```

---

## 🎯 测试成功标准

### 必须通过
- ✅ 能够发起通话
- ✅ 能够接听通话
- ✅ 双向音频传输正常
- ✅ 能够挂断通话

### 期望通过
- ✅ 音质清晰（无杂音、回声）
- ✅ 延迟低（< 500ms）
- ✅ 静音功能正常
- ✅ 通话稳定（5 分钟无断线）

---

## 📞 需要帮助？

如果测试遇到问题，请提供：
1. 设备信息（型号、系统版本）
2. 错误截图或日志
3. 复现步骤

---

**祝测试顺利！** 🚀

